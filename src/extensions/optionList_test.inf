!% -SD
!% +language_name=Spanish

!!==============================================================================
!!
!!	OPTION LIST TEST
!!	Ejemplo de uso de la extensión OptionList
!!
!!==============================================================================
!!
!!	File:			optionList_test.inf
!!	Author(s):		J. Francisco Martín <jfm.lisaso@gmail.com>
!!	Language:		ES (Castellano)
!!	System:			Inform-INFSP 6
!!	Platform:		Z-Machine / Glulx
!!	Version:		1.0
!!	Released:		2014/09/30
!!
!!------------------------------------------------------------------------------
!!
!!	# HISTORIAL DE VERSIONES
!!
!!	1.0: 2014/09/30	Primera versión de la ejemplo.
!!
!!------------------------------------------------------------------------------
!!
!!	Copyright (c) 2014, J. Francisco Martín
!!
!!	Este programa es software libre: usted puede redistribuirlo y/o 
!!	modificarlo bajo los términos de la Licencia Pública General GNU 
!!	publicada por la Fundación para el Software Libre, ya sea la versión 
!!	3 de la Licencia, o (a su elección) cualquier versión posterior.
!!
!!	Este programa se distribuye con la esperanza de que sea útil, pero 
!!	SIN GARANTÍA ALGUNA; ni siquiera la garantía implícita MERCANTIL o 
!!	de APTITUD PARA UN PROPÓSITO DETERMINADO. Consulte los detalles de 
!!	la Licencia Pública General GNU para más información.
!!
!!	Debería haber recibido una copia de la Licencia Pública General GNU 
!!	junto a este programa. En caso contrario, consulte
!!	<http://www.gnu.org/licenses/>.
!!
!!------------------------------------------------------------------------------

Constant Story
"OPTION LIST TEST"

Constant Headline
"^Ejemplo de uso de la extensión OptionList.
^Creado por J. Francisco Martín, 2014";

Include "Parser.h";				! Decodifica la entrada del teclado
Include ">optionList.h";		! Extensión OPTION LIST
Include "VerbLib.h";			! Define cómo trabajan las acciones

[ BeforeParsing;
	OptionListManager.run();
];

[ Initialize;
	location = HABITACION;
	lookmode = 2;
];

Include "SpanishG.h";			! Gramática española

Extend	'habla' replace
	* noun							-> TalkTo
	* 'a'/'con' noun				-> TalkTo
	* creature						-> TalkTo
	* 'a'/'con' creature			-> TalkTo
	* 'por' noun					-> TalkTo
	* 'por' creature				-> TalkTo
;

Verb	'conversa' 'platica'
	* noun							-> TalkTo
	* 'a'/'con' noun				-> TalkTo
	* creature						-> TalkTo
	* 'a'/'con' creature			-> TalkTo
	* 'por' noun					-> TalkTo
	* 'por' creature				-> TalkTo
;

[ TalkToSub;
	!! 1) El personaje intenta hablar consigo mismo:
	if ( noun == player ) {
		"Hablar con uno mismo no resulta especialmente divertido.";
	}
	!! 2) El personaje intenta hablar con un objeto inanimado:
	if ( noun hasnt animate )
		"Sería más interesante intentar hablar con cosas que puedan 
		devolver una respuesta.";
	}
	!! 3) El personaje intenta hablar con un objeto animado:
	print_ret (The) noun, " no parece", (n) noun, " interesado", (o) noun, 
	" en hablar contigo.";
];

Object	LIMBO "En algún lugar"
 with	description [;
			print "No hay absolutamente nada a tu alrededor, sólo un espacio 
			blanco, completamente vacío. Y Bob.^";
			if (self hasnt visited) {
				new_line;
				OptionListManager.start(conversacion_con_Bob);
			}
			return true;
		],
 has	light;

OptionList	conversacion_con_Bob "(Conversación con Bob)"
 with	initial_action [;
			!! Se añaden a la conversación sus temas iniciales:
			self.add_option(op_antena);
			self.add_option(op_faro);
			self.add_option(op_persistente);
			!! Texto inicial de la conversación:
			"---Disculpe...
			^^
			Bob levanta la vista de su libro y se quita las gafas. ---¿Si?";
		],
		inter_action [;
			"Bob simula limpiar sus gafas, inquieto.";
		],
		final_action [; 
			"Bob te ignora, como si no existieses.";
		];

Option	op_antena
 with	entry [; print "Preguntar por la antena"; ],
		keywords 'pregunta' 'preguntar' 'antena',
		reply [;
			"---¿Eso que te sale de la cabeza es una antena?
			^^
			Bob se lleva la mano a la cabeza y toca con los dedos el largo 
			alambre que parece brotarle de en medio del cráneo...
			^^
			---¿Una antena? No tengo ni idea de qué me estás hablando.";
		],
		!! Evita que se añada el listado de opciones tras tratar esta.
		append_option_list false;

Option	op_faro
 with	entry [; print "Hablar sobre el faro"; ],
		keywords 'habla' 'hablar' 'faro',
		reply [;
			"---He pasado junto al faro esta mañana... ---empiezas.
			^^
			Bob se pone muy nervioso de pronto. ---¿De qué estás hablando? 
			Esa cosa se vino abajo hace años. Después de aquel... asunto.";
		],
		!! Las siguientes opciones se eliminan del listado tras tratar esta.
		relatives op_antena2,
		!! Las siguientes opciones se añaden al listado tras tratar esta.
		suboptions op_asunto,
		append_option_list false;

Option op_persistente
 with	entry [; print "Hablar del tema que nunca se acaba"; ],
		keywords 'habla' 'hablar' 'tema' 'nunca' 'acaba' 'interminable',
		reply [;
			"---Bob, ¿dónde está mi coche?
			^^
			---¿Y tu coche, tío?";
		],
		!! Opción persistente. No se elimina del listado automáticamente tras 
		!! haberla tratado.
		persistent true;

Option	op_asunto1
 with	entry [; print "Preguntar por el asunto"; ],
		keywords 'pregunta' 'preguntar' 'asunto',
		reply [;
			"---¿A qué ~asunto~ te refieres?
			^^
			Bob se coloca las gafas y vuelve de nuevo su atención al libro, 
			claramente agitado. ---T-tengo mucho trabajo que hacer. Si me 
			disculpas...";
		],
		relatives op_antena2,
		suboptions op_asunto2;

Option	op_asunto2
 with	entry [; print "Insistir sobre el asunto"; ],
		keywords 'insiste' 'insistir' 'asunto',
		reply [;
			"---Espera, ese ~asunto~ del que has hablado... ¿a qué te 
			referías?
			^^
			---A nada en absoluto ---responde tajante---. Ya sabes cómo 
			funciona el sistema de opciones, ¿no es así? Pues con la misma 
			puedes irte con viento fresco. Muy buenas tardes.";
		],
		reaction [;
			parent(self).end();
		];
	
